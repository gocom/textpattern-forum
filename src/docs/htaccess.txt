<IfModule mod_headers.c>
    # Allow base Textpattern.io domain to access the Forum API.

    SetEnvIf Origin "http(s)?://(www\.)?(textpattern.com|textpattern.io|www.textpattern-com.dev)$" AccessControlAllowOrigin=$0
    Header add Access-Control-Allow-Origin %{AccessControlAllowOrigin}e env=AccessControlAllowOrigin

    # HSTS.

    Header set Strict-Transport-Security "max-age=16070400"

    # Referrer Policy.

    Header always set Referrer-Policy "no-referrer-when-downgrade"

    # Content Security Policy.

    Header unset P3P
    Header always set X-XSS-Protection "1; mode=block"
    Header always set X-Content-Type-Options "nosniff"
    Header always set Content-Security-Policy "default-src 'self'; connect-src 'self' https://syndication.twitter.com; font-src https://textpattern.com; img-src 'self' data: * https://*; style-src 'self' 'unsafe-inline' https://gist.github.com https://*.twitter.com https://*.twimg.com; script-src 'self' https://code.jquery.com https://gist.github.com https://*.twitter.com https://*.twimg.com https://www.google.com/recaptcha/ https://www.gstatic.com/recaptcha/; frame-src https://*.youtube-nocookie.com https://*.twitter.com https://twitter.com https://www.google.com/recaptcha/"

    # Expect-CT (TODO: currently in testing).

    Header set Expect-CT "max-age=0; report-uri=https://forum.textpattern.com/expect-ct-report"

    Header unset ETag
</ifModule>

FileETag None

<IfModule mod_rewrite.c>
    RewriteEngine On

    # Redirect from `.com` to `.io` domain.

    RewriteCond %{HTTP_HOST} ^forum.textpattern.com [NC]
    RewriteRule ^(.*)$ https://forum.textpattern.com/$1 [R=301,L]

    # Redirect from `http://` to `https://` protocol.

    RewriteCond %{HTTPS} !=on
    RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L]

    RewriteCond %{REQUEST_FILENAME} /cache/ [OR]
    RewriteCond %{REQUEST_FILENAME} /include/ [OR]
    RewriteCond %{REQUEST_FILENAME} /lang/ [OR]
    RewriteCond %{REQUEST_FILENAME} /plugins/
    RewriteRule ^(.*) - [F]
</IfModule>

# FluxBB.

DirectoryIndex index.php index.html
Options -Indexes

ErrorDocument 401 "401"
ErrorDocument 403 /403.html
ErrorDocument 404 /404.html
ErrorDocument 500 /500.html
