diff --git a/db_update.php b/db_update.php
index f001b5e7..52cf9744 100644
--- a/db_update.php
+++ b/db_update.php
@@ -116,7 +116,7 @@ require PUN_ROOT.'include/dblayer/common_db.php';
 $old_connection_charset = defined('FORUM_DEFAULT_CHARSET') ? FORUM_DEFAULT_CHARSET : $db->get_names();

 // Set the connection to UTF-8 now
-$db->set_names('utf8');
+$db->set_names('utf8mb4');

 // Get the forum config
 $result = $db->query('SELECT * FROM '.$db->prefix.'config') or error('Unable to fetch config.', __FILE__, __LINE__, $db->error());
diff --git a/edit.php b/edit.php
index d757eeb0..004c548a 100644
--- a/edit.php
+++ b/edit.php
@@ -113,7 +113,7 @@ if (isset($_POST['form_sent']))
 		$stick_topic = $cur_post['sticky'];

 	// Replace four-byte characters (MySQL cannot handle them)
-	$message = strip_bad_multibyte_chars($message);
+	//$message = strip_bad_multibyte_chars($message);

 	// Did everything go according to plan?
 	if (empty($errors) && !isset($_POST['preview']))
diff --git a/extern.php b/extern.php
index d43574be..cfba2187 100644
--- a/extern.php
+++ b/extern.php
@@ -242,7 +242,8 @@ function output_xml($feed)
 			echo "\t\t\t".'<uri>'.pun_htmlspecialchars($item['author']['uri']).'</uri>'."\n";

 		echo "\t\t".'</author>'."\n";
-		echo "\t\t".'<posted>'.gmdate('r', $item['pubdate']).'</posted>'."\n";
+		echo "\t\t".'<posted>'.gmdate('d F Y H:i', $item['pubdate']).'</posted>'."\n";
+		echo "\t\t".'<postedutc>'.gmdate('Y-m-d\TH:i:s\Z', $item['pubdate']).'</postedutc>'."\n";

 		echo "\t".'</'.$forum_tag.'>'."\n";
 	}
diff --git a/include/dblayer/mysql.php b/include/dblayer/mysql.php
index 9b3a91f7..23183a0a 100644
--- a/include/dblayer/mysql.php
+++ b/include/dblayer/mysql.php
@@ -47,7 +47,7 @@ class DBLayer

 		// Setup the client-server character set (UTF-8)
 		if (!defined('FORUM_NO_SET_NAMES'))
-			$this->set_names('utf8');
+			$this->set_names('utf8mb4');

 		return $this->link_id;
 	}
diff --git a/include/dblayer/mysql_innodb.php b/include/dblayer/mysql_innodb.php
index 52c467c2..ca35f330 100644
--- a/include/dblayer/mysql_innodb.php
+++ b/include/dblayer/mysql_innodb.php
@@ -48,7 +48,7 @@ class DBLayer

 		// Setup the client-server character set (UTF-8)
 		if (!defined('FORUM_NO_SET_NAMES'))
-			$this->set_names('utf8');
+			$this->set_names('utf8mb4');

 		return $this->link_id;
 	}
diff --git a/include/dblayer/mysqli.php b/include/dblayer/mysqli.php
index 2f41e838..4050c0db 100644
--- a/include/dblayer/mysqli.php
+++ b/include/dblayer/mysqli.php
@@ -49,7 +49,7 @@ class DBLayer

 		// Setup the client-server character set (UTF-8)
 		if (!defined('FORUM_NO_SET_NAMES'))
-			$this->set_names('utf8');
+			$this->set_names('utf8mb4');

 		return $this->link_id;
 	}
diff --git a/include/dblayer/mysqli_innodb.php b/include/dblayer/mysqli_innodb.php
index 2468fb16..c9519c07 100644
--- a/include/dblayer/mysqli_innodb.php
+++ b/include/dblayer/mysqli_innodb.php
@@ -50,7 +50,7 @@ class DBLayer

 		// Setup the client-server character set (UTF-8)
 		if (!defined('FORUM_NO_SET_NAMES'))
-			$this->set_names('utf8');
+			$this->set_names('utf8mb4');

 		return $this->link_id;
 	}
diff --git a/include/dblayer/pgsql.php b/include/dblayer/pgsql.php
index 983a886f..f16e492b 100644
--- a/include/dblayer/pgsql.php
+++ b/include/dblayer/pgsql.php
@@ -69,7 +69,7 @@ class DBLayer

 		// Setup the client-server character set (UTF-8)
 		if (!defined('FORUM_NO_SET_NAMES'))
-			$this->set_names('utf8');
+			$this->set_names('utf8mb4');

 		return $this->link_id;
 	}
diff --git a/include/email.php b/include/email.php
index ea495f3d..4ef2ffa5 100644
--- a/include/email.php
+++ b/include/email.php
@@ -64,149 +64,7 @@ function encode_mail_text($str)
 //
 function bbcode2email($text, $wrap_length = 72)
 {
-	static $base_url;
-
-	if (!isset($base_url))
-		$base_url = get_base_url();
-
-	$text = pun_trim($text, "\t\n ");
-
-	$shortcut_urls = array(
-		'topic' => '/viewtopic.php?id=$1',
-		'post' => '/viewtopic.php?pid=$1#p$1',
-		'forum' => '/viewforum.php?id=$1',
-		'user' => '/profile.php?id=$1',
-	);
-
-	// Split code blocks and text so BBcode in codeblocks won't be touched
-	list($code, $text) = extract_blocks($text, '[code]', '[/code]');
-
-	// Strip all bbcodes, except the quote, url, img, email, code and list items bbcodes
-	$text = preg_replace(array(
-		'%\[/?(?!(?:quote|url|topic|post|user|forum|img|email|code|list|\*))[a-z]+(?:=[^\]]+)?\]%i',
-		'%\n\[/?list(?:=[^\]]+)?\]%i' // A separate regex for the list tags to get rid of some whitespace
-	), '', $text);
-
-	// Match the deepest nested bbcode
-	// An adapted example from Mastering Regular Expressions
-	$match_quote_regex = '%
-		\[(quote|\*|url|img|email|topic|post|user|forum)(?:=([^\]]+))?\]
-		(
-			(?>[^\[]*)
-			(?>
-				(?!\[/?\1(?:=[^\]]+)?\])
-				\[
-				[^\[]*
-			)*
-		)
-		\[/\1\]
-	%ix';
-
-	$url_index = 1;
-	$url_stack = array();
-	while (preg_match($match_quote_regex, $text, $matches))
-	{
-		// Quotes
-		if ($matches[1] == 'quote')
-		{
-			// Put '>' or '> ' at the start of a line
-			$replacement = preg_replace(
-				array('%^(?=\>)%m', '%^(?!\>)%m'),
-				array('>', '> '),
-				$matches[2]." said:\n".$matches[3]);
-		}
-
-		// List items
-		elseif ($matches[1] == '*')
-		{
-			$replacement = ' * '.$matches[3];
-		}
-
-		// URLs and emails
-		elseif (in_array($matches[1], array('url', 'email')))
-		{
-			if (!empty($matches[2]))
-			{
-				$replacement = '['.$matches[3].']['.$url_index.']';
-				$url_stack[$url_index] = $matches[2];
-				$url_index++;
-			}
-			else
-				$replacement = '['.$matches[3].']';
-		}
-
-		// Images
-		elseif ($matches[1] == 'img')
-		{
-			if (!empty($matches[2]))
-				$replacement = '['.$matches[2].']['.$url_index.']';
-			else
-				$replacement = '['.basename($matches[3]).']['.$url_index.']';
-
-			$url_stack[$url_index] = $matches[3];
-			$url_index++;
-		}
-
-		// Topic, post, forum and user URLs
-		elseif (in_array($matches[1], array('topic', 'post', 'forum', 'user')))
-		{
-			$url = isset($shortcut_urls[$matches[1]]) ? $base_url.$shortcut_urls[$matches[1]] : '';
-
-			if (!empty($matches[2]))
-			{
-				$replacement = '['.$matches[3].']['.$url_index.']';
-				$url_stack[$url_index] = str_replace('$1', $matches[2], $url);
-				$url_index++;
-			}
-			else
-				$replacement = '['.str_replace('$1', $matches[3], $url).']';
-		}
-
-		// Update the main text if there is a replacement
-		if (!is_null($replacement))
-		{
-			$text = str_replace($matches[0], $replacement, $text);
-			$replacement = null;
-		}
-	}
-
-	// Put code blocks and text together
-	if (isset($code))
-	{
-		$parts = explode("\1", $text);
-		$text = '';
-		foreach ($parts as $i => $part)
-		{
-			$text .= $part;
-			if (isset($code[$i]))
-				$text .= trim($code[$i], "\n\r");
-		}
-	}
-
-	// Put URLs at the bottom
-	if ($url_stack)
-	{
-		$text .= "\n\n";
-		foreach ($url_stack as $i => $url)
-			$text .= "\n".' ['.$i.']: '.$url;
-	}
-
-	// Wrap lines if $wrap_length is higher than -1
-	if ($wrap_length > -1)
-	{
-		// Split all lines and wrap them individually
-		$parts = explode("\n", $text);
-		foreach ($parts as $k => $part)
-		{
-			preg_match('%^(>+ )?(.*)%', $part, $matches);
-			$parts[$k] = wordwrap($matches[1].$matches[2], $wrap_length -
-				strlen($matches[1]), "\n".$matches[1]);
-		}
-
-		return implode("\n", $parts);
-	}
-	else
-		return $text;
+	return wordwrap($text, 72);
 }


diff --git a/include/parser.php b/include/parser.php
index b7eb4bd0..a98356c3 100644
--- a/include/parser.php
+++ b/include/parser.php
@@ -64,6 +64,7 @@ $smilies = array(
 //
 function preparse_bbcode($text, &$errors, $is_signature = false)
 {
+	return $text;
 	global $pun_config, $lang_common, $lang_post, $re_list;

 	// Remove empty tags
@@ -889,46 +890,25 @@ function do_smilies($text)
 //
 function parse_message($text, $hide_smilies)
 {
-	global $pun_config, $lang_common, $pun_user;
+	global $pun_config, $cur_post;
+	static $textile = null;

 	if ($pun_config['o_censoring'] == '1')
+	{
 		$text = censor_words($text);
+	}

-	// Convert applicable characters to HTML entities
-	$text = pun_htmlspecialchars($text);
-
-	// If the message contains a code tag we have to split it up (text within [code][/code] shouldn't be touched)
-	if (strpos($text, '[code]') !== false && strpos($text, '[/code]') !== false)
-		list($inside, $text) = extract_blocks($text, '[code]', '[/code]');
-
-	if ($pun_config['p_message_bbcode'] == '1' && strpos($text, '[') !== false && strpos($text, ']') !== false)
-		$text = do_bbcode($text);
-
-	if ($pun_config['o_smilies'] == '1' && $pun_user['show_smilies'] == '1' && $hide_smilies == '0')
-		$text = do_smilies($text);
-
-	// Deal with newlines, tabs and multiple spaces
-	$pattern = array("\n", "\t", '  ', '  ');
-	$replace = array('<br />', '&#160; &#160; ', '&#160; ', ' &#160;');
-	$text = str_replace($pattern, $replace, $text);
+	if ($textile === null)
+    {
+		$textile = new Textpattern\Fluxbb\Textile\Parser();
+    }

-	// If we split up the message before we have to concatenate it together again (code tags)
-	if (isset($inside))
+	if (defined('PUN_NEW_MEMBER') && $cur_post['group_id'] == PUN_NEW_MEMBER)
 	{
-		$parts = explode("\1", $text);
-		$text = '';
-		foreach ($parts as $i => $part)
-		{
-			$text .= $part;
-			if (isset($inside[$i]))
-			{
-				$num_lines = (substr_count($inside[$i], "\n"));
-				$text .= '</p><div class="codebox"><pre'.(($num_lines > 28) ? ' class="vscroll"' : '').'><code>'.pun_trim($inside[$i], "\n\r").'</code></pre></div><p>';
-			}
-		}
+		return $textile->textileRestricted($text, false, true);
 	}

-	return clean_paragraphs($text);
+	return $textile->textileRestricted($text, false, false);
 }


@@ -963,25 +943,23 @@ function clean_paragraphs($text)
 //
 function parse_signature($text)
 {
-	global $pun_config, $lang_common, $pun_user;
+	global $pun_config, $cur_post;
+	static $textile = null;

 	if ($pun_config['o_censoring'] == '1')
+	{
 		$text = censor_words($text);
+	}

-	// Convert applicable characters to HTML entities
-	$text = pun_htmlspecialchars($text);
-
-	if ($pun_config['p_sig_bbcode'] == '1' && strpos($text, '[') !== false && strpos($text, ']') !== false)
-		$text = do_bbcode($text, true);
-
-	if ($pun_config['o_smilies_sig'] == '1' && $pun_user['show_smilies'] == '1')
-		$text = do_smilies($text);
-
+	if ($textile === null)
+	{
+		$textile = new Textpattern\Fluxbb\Textile\Parser();
+	}

-	// Deal with newlines, tabs and multiple spaces
-	$pattern = array("\n", "\t", '  ', '  ');
-	$replace = array('<br />', '&#160; &#160; ', '&#160; ', ' &#160;');
-	$text = str_replace($pattern, $replace, $text);
+	if (defined('PUN_NEW_MEMBER') && $cur_post['group_id'] == PUN_NEW_MEMBER)
+	{
+		return $textile->textileRestricted($text, false, true);
+	}

-	return clean_paragraphs($text);
+	return $textile->textileRestricted($text, false, false);
 }
diff --git a/index.php b/index.php
index 888cc91a..ae25dbc7 100644
--- a/index.php
+++ b/index.php
@@ -62,6 +62,26 @@ $forum_actions = array();
 if (!$pun_user['is_guest'])
 	$forum_actions[] = '<a href="misc.php?action=markread&amp;csrf_token='.pun_csrf_token().'">'.$lang_common['Mark all as read'].'</a>';

+$page_head['meta_robots'] = '<meta name="robots" content="index, follow">';
+$page_head['meta_desc'] = '<meta name="description" content="'.pun_htmlspecialchars($pun_config['o_board_desc']).'">';
+$page_head['twitter-card'] = '<meta name="twitter:card" content="summary">';
+$page_head['twitter-site'] = '<meta name="twitter:site" content="@txpforum">';
+$page_head['twitter-title'] = '<meta name="twitter:title" content="Textpattern CMS support forum">';
+$page_head['twitter-description'] = '<meta name="twitter:description" content="'.pun_htmlspecialchars($pun_config['o_board_desc']).'">';
+$page_head['twitter-image'] = '<meta name="twitter:image:src" content="https://forum.textpattern.io/apple-touch-icon-180x180.png">';
+$page_head['twitter-url'] = '<meta name="twitter:url" content="https://forum.textpattern.io/">';
+$page_head['og-title'] = '<meta property="og:title" content="Textpattern CMS support forum">';
+$page_head['og-description'] = '<meta property="og:description" content="'.pun_htmlspecialchars($pun_config['o_board_desc']).'">';
+$page_head['og-image'] = '<meta property="og:image" content="https://textpattern.io/assets/img/branding/textpattern/textpattern-og.png">';
+$page_head['og-url'] = '<meta property="og:url" content="https://forum.textpattern.io/">';
+$page_head['json-ld'] = '<script type="application/ld+json">'."\n".
+'{"@context": "https://schema",'."\n".
+'"@type": "WebSite",'."\n".
+'"headline": "Textpattern CMS support forum",'."\n".
+'"description": '.json_encode(pun_htmlspecialchars($pun_config['o_board_desc'])).','."\n".
+'"url": "https://forum.textpattern.io/"}'."\n".
+'</script>';
+$page_head['canonical'] = '<link rel="canonical" href="https://forum.textpattern.io/">';
 $page_title = array(pun_htmlspecialchars($pun_config['o_board_title']));
 define('PUN_ALLOW_INDEX', 1);
 define('PUN_ACTIVE_PAGE', 'index');
diff --git a/lang/English/profile.php b/lang/English/profile.php
index 08a2e660..6e91cd54 100644
--- a/lang/English/profile.php
+++ b/lang/English/profile.php
@@ -95,7 +95,7 @@ $lang_profile = array(
 'Avatar info'					=>	'An avatar is a small image that will be displayed with all your posts. You can upload an avatar by clicking the link below.',
 'Change avatar'					=>	'Change avatar',
 'Signature legend'				=>	'Compose your signature',
-'Signature info'				=>	'A signature is a small piece of text that is attached to your posts. In it, you can enter just about anything you like. Perhaps you would like to enter your favourite quote or your star sign. It\'s up to you! In your signature you can use BBCode if it is allowed in this particular forum. You can see the features that are allowed/enabled listed below whenever you edit your signature.',
+'Signature info'				=>	'A signature is a small piece of text that is attached to your posts. In it, you can enter just about anything you like. Perhaps you would like to enter your favourite quote or your star sign. It\'s up to you!',
 'Sig preview'					=>	'Current signature preview:',
 'No sig'						=>	'No signature currently stored in profile.',
 'Signature quote/code/list/h'	=>	'The quote, code, list, and heading BBCodes are not allowed in signatures.',
diff --git a/post.php b/post.php
index cc01a1a0..5936a15d 100644
--- a/post.php
+++ b/post.php
@@ -159,7 +159,7 @@ if (isset($_POST['form_sent']))
 	$stick_topic = isset($_POST['stick_topic']) && $is_admmod ? '1' : '0';

 	// Replace four-byte characters (MySQL cannot handle them)
-	$message = strip_bad_multibyte_chars($message);
+	//$message = strip_bad_multibyte_chars($message);

 	$now = time();

diff --git a/viewforum.php b/viewforum.php
index 2607a219..63936749 100644
--- a/viewforum.php
+++ b/viewforum.php
@@ -80,20 +80,39 @@ $paging_links = '<span class="pages-label">'.$lang_common['Pages'].' </span>'.pa

 // Add relationship meta tags
 $page_head = array();
-$page_head['canonical'] = '<link rel="canonical" href="viewforum.php?id='.$id.($p == 1 ? '' : '&amp;p='.$p).'" title="'.sprintf($lang_common['Page'], $p).'" />';
+$page_head['meta_robots'] = '<meta name="robots" content="noindex, follow">';
+$page_head['meta_desc'] = '<meta name="description" content="Listings in'.($p == 1 ? '' : ' page '.$p.' of').' the ‘'.pun_htmlspecialchars($cur_forum['forum_name']).'’ subforum at the Textpattern CMS support forum.">';
+$page_head['twitter-card'] = '<meta name="twitter:card" content="summary">';
+$page_head['twitter-site'] = '<meta name="twitter:site" content="@txpforum">';
+$page_head['twitter-title'] = '<meta name="twitter:title" content="'.pun_htmlspecialchars($cur_forum['forum_name']).($p == 1 ? '' : ' ('.sprintf($lang_common['Page'], $p).')').'">';
+$page_head['twitter-description'] = '<meta name="twitter:description" content="Listings in'.($p == 1 ? '' : ' page '.$p.' of').' the ‘'.pun_htmlspecialchars($cur_forum['forum_name']).'’ subforum at the Textpattern CMS support forum.">';
+$page_head['twitter-image'] = '<meta name="twitter:image:src" content="https://forum.textpattern.io/apple-touch-icon-180x180.png">';
+$page_head['twitter-url'] = '<meta name="twitter:url" content="https://forum.textpattern.io/viewforum.php?id='.$id.($p == 1 ? '' : '&amp;p='.$p).'">';
+$page_head['og-title'] = '<meta property="og:title" content="'.pun_htmlspecialchars($cur_forum['forum_name']).($p == 1 ? '' : ' ('.sprintf($lang_common['Page'], $p).')').'">';
+$page_head['og-description'] = '<meta property="og:description" content="Listings in'.($p == 1 ? '' : ' page '.$p.' of').' the ‘'.pun_htmlspecialchars($cur_forum['forum_name']).'’ subforum at the Textpattern CMS support forum.">';
+$page_head['og-image'] = '<meta property="og:image" content="https://textpattern.io/assets/img/branding/textpattern/textpattern-og.png">';
+$page_head['og-url'] = '<meta property="og:url" content="https://forum.textpattern.io/viewforum.php?id='.$id.($p == 1 ? '' : '&amp;p='.$p).'">';
+$page_head['json-ld'] = '<script type="application/ld+json">'."\n".
+'{"@context": "https://schema",'."\n".
+'"@type": "WebPage",'."\n".
+'"headline": '.json_encode(pun_htmlspecialchars($cur_forum['forum_name']).($p == 1 ? '' : ' ('.sprintf($lang_common['Page'], $p).')')).','."\n".
+'"description": '.json_encode(pun_htmlspecialchars('Listings in'.($p == 1 ? '' : ' page '.$p.' of').' the ‘'.pun_htmlspecialchars($cur_forum['forum_name']).'’ subforum at the Textpattern CMS support forum.')).','."\n".
+'"url": "https://forum.textpattern.io/viewforum.php?id='.intval($id).($p == 1 ? '' : '&p='.intval($p)).'"}'."\n".
+'</script>';
+$page_head['canonical'] = '<link rel="canonical" href="https://forum.textpattern.io/viewforum.php?id='.$id.($p == 1 ? '' : '&amp;p='.$p).'" title="'.sprintf($lang_common['Page'], $p).'">';

 if ($num_pages > 1)
 {
 	if ($p > 1)
-		$page_head['prev'] = '<link rel="prev" href="viewforum.php?id='.$id.($p == 2 ? '' : '&amp;p='.($p - 1)).'" title="'.sprintf($lang_common['Page'], $p - 1).'" />';
+		$page_head['prev'] = '<link rel="prev" href="https://forum.textpattern.io/viewforum.php?id='.$id.($p == 2 ? '' : '&amp;p='.($p - 1)).'" title="'.sprintf($lang_common['Page'], $p - 1).'">';
 	if ($p < $num_pages)
-		$page_head['next'] = '<link rel="next" href="viewforum.php?id='.$id.'&amp;p='.($p + 1).'" title="'.sprintf($lang_common['Page'], $p + 1).'" />';
++		$page_head['next'] = '<link rel="next" href="https://forum.textpattern.io/viewforum.php?id='.$id.'&amp;p='.($p + 1).'" title="'.sprintf($lang_common['Page'], $p + 1).'">';
 }

 if ($pun_config['o_feed_type'] == '1')
-	$page_head['feed'] = '<link rel="alternate" type="application/rss+xml" href="extern.php?action=feed&amp;fid='.$id.'&amp;type=rss" title="'.$lang_common['RSS forum feed'].'" />';
+	$page_head['feed'] = '<link rel="alternate" type="application/rss+xml" href="extern.php?action=feed&amp;fid='.$id.'&amp;type=rss" title="'.$lang_common['RSS forum feed'].'">';
 else if ($pun_config['o_feed_type'] == '2')
-	$page_head['feed'] = '<link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;fid='.$id.'&amp;type=atom" title="'.$lang_common['Atom forum feed'].'" />';
+	$page_head['feed'] = '<link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;fid='.$id.'&amp;type=atom" title="'.$lang_common['Atom forum feed'].'">';

 $forum_actions = array();

diff --git a/viewtopic.php b/viewtopic.php
index 618b699d..f2e25882 100644
--- a/viewtopic.php
+++ b/viewtopic.php
@@ -171,20 +171,39 @@ else

 // Add relationship meta tags
 $page_head = array();
-$page_head['canonical'] = '<link rel="canonical" href="viewtopic.php?id='.$id.($p == 1 ? '' : '&amp;p='.$p).'" title="'.sprintf($lang_common['Page'], $p).'" />';
+$page_head['meta_robots'] = '<meta name="robots" content="index, follow">';
+$page_head['meta_desc'] = '<meta name="description" content="Postings in'.($p == 1 ? '' : ' page '.$p.' of').' the ‘'.pun_htmlspecialchars($cur_topic['subject']).'’ topic in the ‘'.pun_htmlspecialchars($cur_topic['forum_name']).'’ subforum.">';
+$page_head['twitter-card'] = '<meta name="twitter:card" content="summary">';
+$page_head['twitter-site'] = '<meta name="twitter:site" content="@txpforum">';
+$page_head['twitter-title'] = '<meta name="twitter:title" content="'.pun_htmlspecialchars($cur_topic['subject']).($p == 1 ? '' : ' ('.sprintf($lang_common['Page'], $p).')').'">';
+$page_head['twitter-description'] = '<meta name="twitter:description" content="Postings in'.($p == 1 ? '' : ' page '.$p.' of').' the ‘'.pun_htmlspecialchars($cur_topic['subject']).'’ topic in the ‘'.pun_htmlspecialchars($cur_topic['forum_name']).'’ subforum.">';
+$page_head['twitter-image'] = '<meta name="twitter:image:src" content="https://forum.textpattern.io/apple-touch-icon-180x180.png">';
+$page_head['twitter-url'] = '<meta name="twitter:url" content="https://forum.textpattern.io/viewtopic.php?id='.$id.($p == 1 ? '' : '&amp;p='.$p).'">';
+$page_head['og-title'] = '<meta property="og:title" content="'.pun_htmlspecialchars($cur_topic['subject']).($p == 1 ? '' : ' ('.sprintf($lang_common['Page'], $p).')').'">';
+$page_head['og-description'] = '<meta property="og:description" content="Postings in'.($p == 1 ? '' : ' page '.$p.' of').' the ‘'.pun_htmlspecialchars($cur_topic['subject']).'’ topic in the ‘'.pun_htmlspecialchars($cur_topic['forum_name']).'’ subforum.">';
+$page_head['og-image'] = '<meta property="og:image" content="https://textpattern.io/assets/img/branding/textpattern/textpattern-og.png">';
+$page_head['og-url'] = '<meta property="og:url" content="https://forum.textpattern.io/viewtopic.php?id='.$id.($p == 1 ? '' : '&amp;p='.$p).'">';
+$page_head['json-ld'] = '<script type="application/ld+json">'."\n".
+'{"@context": "https://schema",'."\n".
+'"@type": "WebPage",'."\n".
+'"headline": '.json_encode(pun_htmlspecialchars($cur_topic['subject']).($p == 1 ? '' : ' ('.sprintf($lang_common['Page'], $p).')')).','."\n".
+'"description": '.json_encode(pun_htmlspecialchars('Postings in'.($p == 1 ? '' : ' page '.$p.' of').' the ‘'.$cur_topic['subject'].'’ topic in the ‘'.$cur_topic['forum_name'].'’ subforum.')).','."\n".
+'"url": "https://forum.textpattern.io/viewtopic.php?id='.intval($id).($p == 1 ? '' : '&p='.intval($p)).'"}'."\n".
+'</script>';
+$page_head['canonical'] = '<link rel="canonical" href="https://forum.textpattern.io/viewtopic.php?id='.$id.($p == 1 ? '' : '&amp;p='.$p).'" title="'.sprintf($lang_common['Page'], $p).'">';

 if ($num_pages > 1)
 {
 	if ($p > 1)
-		$page_head['prev'] = '<link rel="prev" href="viewtopic.php?id='.$id.($p == 2 ? '' : '&amp;p='.($p - 1)).'" title="'.sprintf($lang_common['Page'], $p - 1).'" />';
+		$page_head['prev'] = '<link rel="prev" href="https://forum.textpattern.io/viewtopic.php?id='.$id.($p == 2 ? '' : '&amp;p='.($p - 1)).'" title="'.sprintf($lang_common['Page'], $p - 1).'">';
 	if ($p < $num_pages)
-		$page_head['next'] = '<link rel="next" href="viewtopic.php?id='.$id.'&amp;p='.($p + 1).'" title="'.sprintf($lang_common['Page'], $p + 1).'" />';
+		$page_head['next'] = '<link rel="next" href="https://forum.textpattern.io/viewtopic.php?id='.$id.'&amp;p='.($p + 1).'" title="'.sprintf($lang_common['Page'], $p + 1).'">';
 }

 if ($pun_config['o_feed_type'] == '1')
-	$page_head['feed'] = '<link rel="alternate" type="application/rss+xml" href="extern.php?action=feed&amp;tid='.$id.'&amp;type=rss" title="'.$lang_common['RSS topic feed'].'" />';
+	$page_head['feed'] = '<link rel="alternate" type="application/rss+xml" href="extern.php?action=feed&amp;tid='.$id.'&amp;type=rss" title="'.$lang_common['RSS topic feed'].'">';
 else if ($pun_config['o_feed_type'] == '2')
-	$page_head['feed'] = '<link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid='.$id.'&amp;type=atom" title="'.$lang_common['Atom topic feed'].'" />';
+	$page_head['feed'] = '<link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid='.$id.'&amp;type=atom" title="'.$lang_common['Atom topic feed'].'">';

 $page_title = array(pun_htmlspecialchars($pun_config['o_board_title']), pun_htmlspecialchars($cur_topic['forum_name']), pun_htmlspecialchars($cur_topic['subject']));
 define('PUN_ALLOW_INDEX', 1);
