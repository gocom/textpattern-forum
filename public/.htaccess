<IfModule mod_headers.c>
    # Allow base Textpattern.io domain to access the Forum API.

    SetEnvIf Origin "http(s)?://(www\.)?(textpattern.com|textpattern.io|www.textpattern-com.dev)$" AccessControlAllowOrigin=$0
    Header add Access-Control-Allow-Origin %{AccessControlAllowOrigin}e env=AccessControlAllowOrigin

    # HSTS.

    Header set Strict-Transport-Security "max-age=16070400"

    # Referrer Policy.

    Header always set Referrer-Policy "no-referrer"

    # Content Security Policy.

    Header unset P3P
    Header append X-XSS-Protection "1; mode=block"
    Header append X-Frame-Options "DENY"
    Header append X-Content-Type-Options "nosniff"
    Header append Content-Security-Policy "default-src 'self'; font-src textpattern.io https://textpattern.io; img-src 'self' data: * https://*; style-src 'self' 'unsafe-inline' gist.github.com *.twitter.com *.twimg.com https://gist.github.com https://*.twitter.com https://*.twimg.com; script-src 'self' 'unsafe-eval' www.google.com www.gstatic.com code.jquery.com gist.github.com cdnjs.cloudflare.com *.google-analytics.com *.twitter.com *.twimg.com https://www.google.com https://www.gstatic.com https://code.jquery.com https://gist.github.com https://cdnjs.cloudflare.com https://*.google-analytics.com https://*.twitter.com https://*.twimg.com; child-src *.google.com https://*.google.com *.youtube-nocookie.com https://*.youtube-nocookie.com *.twitter.com https://*.twitter.com twitter.com https://twitter.com"

    Header unset ETag
</ifModule>

FileETag None

<IfModule mod_rewrite.c>
    RewriteEngine On

    # Redirect from `.com` to `.io` domain.

    RewriteCond %{HTTP_HOST} ^forum.textpattern.com [NC]
    RewriteRule ^(.*)$ https://forum.textpattern.io/$1 [R=301,L]

    # Redirect from `http://` to `https://` protocol.

    RewriteCond %{HTTPS} !=on
    RewriteRule ^(.*)$ https://%{HTTP_HOST}/$1 [R=301,L]

    RewriteCond %{REQUEST_FILENAME} /cache/ [OR]
    RewriteCond %{REQUEST_FILENAME} /include/ [OR]
    RewriteCond %{REQUEST_FILENAME} /lang/ [OR]
    RewriteCond %{REQUEST_FILENAME} /plugins/
    RewriteRule ^(.*) - [F]
</IfModule>

# FluxBB.

DirectoryIndex index.php index.html
Options -Indexes

ErrorDocument 401 "401"
ErrorDocument 403 /403.html
ErrorDocument 404 /404.html
ErrorDocument 500 /500.html
